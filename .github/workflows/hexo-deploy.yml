# 工作流名称，可自定义
name: Hexo Deploy to gh-pages

# 触发条件：当 main 分支有 push 操作时（比如上传/修改源码），自动执行
on:
  push:
    branches:
      - main  # 源码所在分支，若你的源码在 master 分支，改成 master

# 执行的任务
jobs:
  deploy:
    # 运行环境：Ubuntu 最新版
    runs-on: ubuntu-latest

    steps:
      # 步骤1：拉取 main 分支的源码到服务器
      - name: Checkout main branch
        uses: actions/checkout@v4
        with:
          # 拉取完整历史（部分主题需要）
          fetch-depth: 0

      # 步骤2：安装 Node.js（Hexo 依赖 Node.js）
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'  # Node.js 版本，建议 16+/18+，兼容 Hexo
          cache: 'npm'        # 缓存 npm 依赖，加速下次构建

      # 步骤3：安装 Hexo 及项目依赖
      - name: Install Dependencies
        run: |
          npm install -g hexo-cli  # 全局安装 Hexo 脚手架
          npm install              # 安装项目 package.json 中的依赖

      # 步骤4：生成静态文件（hexo generate）
      - name: Generate Hexo Public Files
        run: hexo clean && hexo generate  # 先清理旧文件，再生成 public

      # 步骤5：将 public 文件夹部署到 gh-pages 分支
      - name: Deploy to gh-pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          # 自动生成的 GITHUB_TOKEN，无需手动配置，GitHub 会自动提供
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # 要部署的文件夹（Hexo 生成的 public）
          publish_dir: ./public
          # 部署到 gh-pages 分支
          publish_branch: gh-pages
          # 提交信息，可自定义
          commit_message: 'Deploy Hexo site: ${{ github.event.head_commit.message }}'